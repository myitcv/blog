<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Portable CI/CD with pure Go GitHub Actions | blog.myitcv.io</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Portable CI/CD with pure Go GitHub Actions" />
<meta name="author" content="paul" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I recently converted the govim project to use GitHub Actions. The move away from TravisCI was largely motivated by more generous concurrency limits (GitHub‚Äôs 20 jobs vs TravisCI‚Äôs 5), faster job startup times, and solid cross-platform support. But there was also the promise of making it easy to extend workflows with composable third-party actions. This post demonstrates how to write cross-platform, pure Go GitHub actions that you can use in your workflows and share with others. But first we start by motivating the real problem we are trying to solve." />
<meta property="og:description" content="I recently converted the govim project to use GitHub Actions. The move away from TravisCI was largely motivated by more generous concurrency limits (GitHub‚Äôs 20 jobs vs TravisCI‚Äôs 5), faster job startup times, and solid cross-platform support. But there was also the promise of making it easy to extend workflows with composable third-party actions. This post demonstrates how to write cross-platform, pure Go GitHub actions that you can use in your workflows and share with others. But first we start by motivating the real problem we are trying to solve." />
<link rel="canonical" href="https://blog.myitcv.io/2020/02/04/portable-ci-cd-with-pure-go-github-actions.html" />
<meta property="og:url" content="https://blog.myitcv.io/2020/02/04/portable-ci-cd-with-pure-go-github-actions.html" />
<meta property="og:site_name" content="blog.myitcv.io" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-02-04T00:00:00+00:00" />
<script type="application/ld+json">
{"description":"I recently converted the govim project to use GitHub Actions. The move away from TravisCI was largely motivated by more generous concurrency limits (GitHub‚Äôs 20 jobs vs TravisCI‚Äôs 5), faster job startup times, and solid cross-platform support. But there was also the promise of making it easy to extend workflows with composable third-party actions. This post demonstrates how to write cross-platform, pure Go GitHub actions that you can use in your workflows and share with others. But first we start by motivating the real problem we are trying to solve.","headline":"Portable CI/CD with pure Go GitHub Actions","dateModified":"2020-02-04T00:00:00+00:00","datePublished":"2020-02-04T00:00:00+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.myitcv.io/2020/02/04/portable-ci-cd-with-pure-go-github-actions.html"},"url":"https://blog.myitcv.io/2020/02/04/portable-ci-cd-with-pure-go-github-actions.html","author":{"@type":"Person","name":"paul"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://blog.myitcv.io/feed.xml" title="blog.myitcv.io" /></head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">blog.myitcv.io</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>
      </nav></div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Portable CI/CD with pure Go GitHub Actions</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-02-04T00:00:00+00:00" itemprop="datePublished">Feb 4, 2020
      </time>‚Ä¢ <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">paul</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I recently converted the <a href="https://github.com/govim/govim"><code class="language-plaintext highlighter-rouge">govim</code></a> project to use <a href="https://github.com/features/actions">GitHub
Actions</a>. The move away from <a href="https://travis-ci.org/">TravisCI</a> was largely
motivated by more generous concurrency limits (<a href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/about-github-actions#usage-limits">GitHub‚Äôs
20</a>
jobs vs TravisCI‚Äôs 5), faster job startup times, and solid cross-platform support. But there was also the promise of
making it easy to extend workflows with composable third-party actions. This post  demonstrates how to write
cross-platform, pure Go GitHub actions that you can  use in your workflows and share with others. But first we start by
motivating the real problem we are trying to solve.</p>

<h3 id="wait-theres-a-problem-with-github-actions">Wait, there‚Äôs a problem with GitHub Actions?</h3>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Did you know that malicious code can be inserted into any GitHub action, even those which are tagged ?<br />I wrote a blog post about it:<a href="https://t.co/PNq2MwaMUN">https://t.co/PNq2MwaMUN</a> cc <a href="https://twitter.com/github?ref_src=twsrc%5Etfw">@github</a> <a href="https://t.co/gUevMJOS6n">pic.twitter.com/gUevMJOS6n</a></p>&mdash; Julien Renaux (@julienrenaux) <a href="https://twitter.com/julienrenaux/status/1208046853780062210?ref_src=twsrc%5Etfw">December 20, 2019</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p><a href="https://twitter.com/julienrenaux">Julien Renaux‚Äôs</a> blog post linked from that tweet does a good job of laying out one
of the core problems with GitHub Actions. The story goes roughly like this:</p>

<ul>
  <li>someone writes and open-sources an action that requires secret credentials, e.g. DockerHub access token</li>
  <li>lots of people start using the action via directives like <code class="language-plaintext highlighter-rouge">uses: good/action@v1</code> because it‚Äôs well written and useful</li>
  <li>original author welcomes a new maintainer on board</li>
  <li>somehow existing action version tags get moved, pointing to malicious code that steals secrets (any maintainer can
update a branch or a tag)</li>
</ul>

<p>Hence the specific advice is to use a commit hash to partially mitigate this risk:</p>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">That‚Äôs why you need to specify the exact version (action@sha1) you want to use, so further changes won‚Äôt impact you.</p>&mdash; Alain H√©la√Øli (@AlainHelaili) <a href="https://twitter.com/AlainHelaili/status/1205238489056501761?ref_src=twsrc%5Etfw">December 12, 2019</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p><em>It is somewhat unfortunate at best that this isn‚Äôt the default advice in the official documentation; worth noting it
doesn‚Äôt defend against the commit disappearing.</em></p>

<p>The problems don‚Äôt stop there, because there is also the risk that transitive dependencies can do malicious things too:</p>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">There is also a risk that the transitive dependencies can do malicious things.<a href="https://t.co/juffjxwxIr">https://t.co/juffjxwxIr</a></p>&mdash; DrSensorüëπ (@dr\_sensor) <a href="https://twitter.com/dr_sensor/status/1208098900747284480?ref_src=twsrc%5Etfw">December 20, 2019</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>On top of this, it‚Äôs not made particularly clear to users that every action they use in their workflow is given implicit
access to an access token that has fairly <a href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/authenticating-with-the-github_token#permissions-for-the-github_token">wide-ranging read-write access to the host
repository</a>.</p>

<p>So we clearly have a software dependency problem here.</p>

<h3 id="why-go">Why Go?</h3>

<p><a href="https://twitter.com/_rsc">Russ Cox</a> has <a href="https://research.swtch.com/deps">repeatedly</a> <a href="https://twitter.com/_rsc/status/1088109141409837063">written</a> about ‚ÄúOur Software Dependency Problem.‚Äù The basic premise of those articles is that ‚Äúsoftware dependencies carry with them serious risks that are too often overlooked.‚Äù Whilst Russ‚Äô articles raise awareness of the risks and encourage more investigation of solutions (and I strongly encourage you to read the article in full), the bottom line is that Go has a comprehensive solution to the major problems outlined, via the <a href="https://proxy.golang.org/">Go Module Mirror</a>, <a href="https://index.golang.org/">Index</a>, and <a href="https://sum.golang.org/">Checksum Database</a>, that ultimately results in the <code class="language-plaintext highlighter-rouge">go</code> command referencing an auditable checksum database to authenticate modules. Coupled with the <a href="https://research.swtch.com/vgo-mvs">minimum version selection</a> property of Go modules, we have ourselves a verifiable way to run exactly the (third party) action code we  previously audited (you all audit your dependencies, right?)</p>

<h3 id="the-slight-wrinkle">The slight wrinkle</h3>

<p>At the time of writing (2020/02/04), GitHub does not natively support writing actions in Go:</p>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Hi <a href="https://twitter.com/github?ref_src=twsrc%5Etfw">@github</a> - please can you provide a native way to write/use actions written in Go, that would allow me to do something like:<br /><br /> uses: $package@$version<br /><br />which would then use <a href="https://t.co/fGOHqwoWSA">https://t.co/fGOHqwoWSA</a> for resolution, and <a href="https://t.co/hqG8e8gGf6">https://t.co/hqG8e8gGf6</a> for verification. Thanks <a href="https://twitter.com/hashtag/golang?src=hash&amp;ref_src=twsrc%5Etfw">#golang</a></p>&mdash; Paul Jolly (@\_myitcv) <a href="https://twitter.com/_myitcv/status/1224288510053691393?ref_src=twsrc%5Etfw">February 3, 2020</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>Instead, you have <a href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/about-actions">the
choice</a> of writing
either:</p>

<ul>
  <li>Docker container-based actions (Linux only; Docker also works on Windows but the official GitHub Actions docs don‚Äôt
yet list that as ‚Äúsupported‚Äù)</li>
  <li>JavaScript-based actions (Linux, macOS, Windows)</li>
</ul>

<p>With the goal of being fully cross-platform in mind, Docker actions are therefore ruled out.</p>

<p>I fell out of love with JavaScript a long time ago, a process that was accelerated by my working on
<a href="https://github.com/gopherjs/gopherjs">GopherJS</a> (a compiler from Go to JavaScript). Having to return to its ‚Äúunique‚Äù
approach didn‚Äôt exactly fill me with glee, but given the current state of affairs there was, seemingly, no other option.
Indeed, the first couple of iterations of writing pure Go GitHub actions  used GopherJS and the <a href="https://github.com/golang/go/wiki/WebAssembly">Go‚Äôs WebAssembly
port</a>. However, both fell a long way short because neither support
fork/exec syscalls.</p>

<h3 id="the-solution">The solution</h3>

<p>With half a mind to GitHub eventually shipping native support for Go actions, I instead landed on a solution that uses a
light JavaScript wrapper around the <code class="language-plaintext highlighter-rouge">go</code> command. Let‚Äôs explore that approach by writing an action.</p>

<p>But first, let‚Äôs start by defining what our toy action will do. Incorporated into a workflow, this toy action will take
a single input, the user‚Äôs name, and will output a line like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello, Helena! We are running on linux; Hooray!
</code></pre></div></div>

<p>(obviously adapted to the name of the user and the platform on which our workflow is running).</p>

<h3 id="creating-a-module-for-our-action">Creating a module for our action</h3>

<p>The documentation for <a href="https://golang.org/cmd/go/#hdr-Modules__module_versions__and_more"><code class="language-plaintext highlighter-rouge">cmd/go</code></a> says of modules:</p>

<blockquote>
  <p>A module is a collection of related Go packages. Modules are the unit of source code interchange and versioning.</p>
</blockquote>

<p>The is precisely the definition we are after when it comes to GitHub Actions: we want users of the action to express
their dependency on semver versions of our action.</p>

<p>We start therefore by creating a module:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ go mod init github.com/myitcv/myfirstgoaction
</code></pre></div></div>

<p>Before we define the action itself, we briefly discuss a key building block: the GitHub Actions API.</p>

<h3 id="github-actions-api">GitHub Actions API</h3>

<p>GitHub Actions has an <a href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/development-tools-for-github-actions">API for action
authors</a>
which is published as an <a href="https://github.com/actions/toolkit">official GitHub Actions SDK for Node.js</a>. <a href="https://twitter.com/sethvargo">Seth
Vargo</a> has put together an <a href="https://github.com/sethvargo/go-githubactions">unofficial GitHub Actions SDK for
Go</a> that ‚Äúprovides a Go-like interface for working with GitHub Actions.‚Äù
Thank you, Seth!</p>

<p>Briefly skimming the <a href="https://pkg.go.dev/github.com/sethvargo/go-githubactions?tab=doc">SDK documentation</a>, it‚Äôs clear
to see how we will be <a href="https://pkg.go.dev/github.com/sethvargo/go-githubactions?tab=doc#GetInput">getting our input</a>,
the name of the user:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// GetInput gets the input by the given name.
func GetInput(i string) string
</code></pre></div></div>

<p>We now have the relevant pieces in place to define our action.</p>

<h3 id="the-go-code">The Go code</h3>

<p>The Go code is now, therefore, the simplest part of this action‚Äôs definition.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cat</span> <span class="n">main</span><span class="o">.</span><span class="k">go</span>
<span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>

	<span class="s">"github.com/sethvargo/go-githubactions"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">name</span> <span class="o">:=</span> <span class="n">githubactions</span><span class="o">.</span><span class="n">GetInput</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Hello, %v! We are running on %v; Hooray!</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">platform</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The platform-specific bit we will put behind build constrained files to demonstrate that aspects works too:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cat</span> <span class="n">platform_linux</span><span class="o">.</span><span class="k">go</span>
<span class="k">package</span> <span class="n">main</span>

<span class="k">func</span> <span class="n">platform</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="k">return</span> <span class="s">"linux"</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Hopefully the contents for <code class="language-plaintext highlighter-rouge">platform_darwin.go</code> and <code class="language-plaintext highlighter-rouge">platform_windows.go</code> are obvious.</p>

<h3 id="creating-an-action-metadata-file">Creating an action metadata file</h3>

<p>The next step is to create an action metadata file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">$ cat action.yml</span>
<span class="na">name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Greeter'</span>
<span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Print</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">platform-aware</span><span class="nv"> </span><span class="s">greeting</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">user'</span>
<span class="na">inputs</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">The</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">user'</span>
    <span class="na">required</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">runs</span><span class="pi">:</span>
  <span class="na">using</span><span class="pi">:</span> <span class="s1">'</span><span class="s">node12'</span>
  <span class="na">main</span><span class="pi">:</span> <span class="s1">'</span><span class="s">index.js'</span>
</code></pre></div></div>

<p>Notice how we are running using NodeJS with an entry point of <code class="language-plaintext highlighter-rouge">index.js</code>; we talk about that next.</p>

<h3 id="the-indexjs-entry-point">The <code class="language-plaintext highlighter-rouge">index.js</code> entry point</h3>

<p>Whilst we await native support for pure Go GitHub Actions, the simplest solution to running Go actions is a thin NodeJS
wrapper around <code class="language-plaintext highlighter-rouge">cmd/go</code>. For now this should be copy-pasted for each action you create:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">cat</span> <span class="nx">index</span><span class="p">.</span><span class="nx">js</span>
<span class="dl">"</span><span class="s2">use strict</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">spawn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">child_process</span><span class="dl">"</span><span class="p">).</span><span class="nx">spawn</span><span class="p">;</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">cmd</span> <span class="o">=</span> <span class="nx">spawn</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">args</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">{</span>
    <span class="na">stdio</span><span class="p">:</span> <span class="dl">"</span><span class="s2">inherit</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">cwd</span><span class="p">:</span> <span class="nx">__dirname</span>
  <span class="p">});</span>
  <span class="kd">const</span> <span class="nx">exitCode</span> <span class="o">=</span> <span class="k">await</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">cmd</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">close</span><span class="dl">"</span><span class="p">,</span> <span class="nx">resolve</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">exitCode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="nx">exitCode</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="p">(</span><span class="k">async</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">);</span>
  <span class="k">await</span> <span class="nx">run</span><span class="p">(</span><span class="dl">"</span><span class="s2">go</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">run</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.</span><span class="dl">"</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre></div></div>

<p>Clearly copy-pasting this boilerplate, even in the short term, is not ideal. I am looking at ways to simplify and
automate this step using a Go tool (ideas also welcomed).</p>

<h3 id="using-our-action">Using our action</h3>

<p>Now let‚Äôs switch to creating a project that uses the Greeter action in one of its workflows:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">$ go mod init github.com/myitcv/usingmyfirstgoaction</span>
<span class="s">$ cat .github/workflows/test.yml</span>
<span class="na">on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">push</span><span class="pi">,</span> <span class="nv">pull_request</span><span class="pi">]</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Test</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">test</span><span class="pi">:</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">platform</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">ubuntu-latest</span><span class="pi">,</span> <span class="nv">macos-latest</span><span class="pi">,</span> <span class="nv">windows-latest</span><span class="pi">]</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">$</span>
    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-go@9fbc767707c286e568c92927bbf57d76b73e0892</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">go-version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">1.14.x'</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Display a greeting</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">myitcv/myfirstgoaction@d085dddfc01ecb14af3778b49dd8672fcd0e7652</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">Helena</span>
</code></pre></div></div>

<p>We specify a matrix of all platforms to demonstrate our action truly is cross-platform.</p>

<p>Given GitHub Actions don‚Äôt natively support Go actions, and as we demonstrated in our <code class="language-plaintext highlighter-rouge">index.js</code> wrapper, we have to use
the <code class="language-plaintext highlighter-rouge">go</code> command. We therefore must have <a href="https://github.com/actions/setup-go"><code class="language-plaintext highlighter-rouge">actions/setup-go</code></a> as our first step in
any workflow that uses a Go action of this sort (until native actions come along).</p>

<p>Finally, both <code class="language-plaintext highlighter-rouge">uses: actions/setup-go</code> and <code class="language-plaintext highlighter-rouge">uses: myitcv/myfirstgoaction</code> specify specific commits, per advice earlier
in this post.</p>

<p>That‚Äôs it! Let‚Äôs commit, push and watch the build succeed!</p>

<p><img src="/images/2020-02-04-build-success.png" alt="A successful build" title="A successful build" /></p>

<h3 id="so-what-would-native-actions-look-like">So what would native actions look like?</h3>

<p>There are a few problems with the approach outlined above:</p>

<ol>
  <li>we need to explicitly install Go</li>
  <li>we need to copy-paste our <code class="language-plaintext highlighter-rouge">index.js</code> wrapper for each Go action we create</li>
  <li>we are not relying on the Go module proxy when using the action and hence have to specify a commit rather than a
semver version</li>
</ol>

<p>Points 1 and 2 clearly disappear when native support is added.</p>

<p>Point 3 is particularly brittle because commits themselves can disappear from GitHub (force pushing to <code class="language-plaintext highlighter-rouge">master</code>, commit
no longer referenced by any tags or branches, gets cleaned up).</p>

<p>Therefore, given point 3 we ideally would use our action in a workflow in the following way:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Display a greeting</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">github.com/myitcv/myfirstgoaction@v1.0.0</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">Helena</span>
</code></pre></div></div>

<p>such that when running the action, GitHub‚Äôs infrastructure:</p>

<ul>
  <li>creates a temporary module</li>
  <li>resolves the Go package <code class="language-plaintext highlighter-rouge">github.com/myitcv/myfirstgoaction</code> at version <code class="language-plaintext highlighter-rouge">v1.0.0</code> via
<a href="https://proxy.golang.org">proxy.golang.org</a></li>
  <li>runs the action via <code class="language-plaintext highlighter-rouge">go run github.com/myitcv/myfirstgoaction</code></li>
</ul>

<p><em>Notice, the package path and module path being equal is just a coincidence of this example</em></p>

<h3 id="conclusion">Conclusion</h3>

<p>Go provides some novel solutions to the problems of software dependencies. In this article I have demonstrated one way
in which pure Go actions can be written today (whilst we await native support from GitHub), leveraging the benefits and
protections of the Go Module Mirror, Index, and Checksum Database. Ultimately we all need to review our software
dependencies, but at least Go makes it easier to know that the world hasn‚Äôt changed under our feet from build-to-build.</p>

<h3 id="appendix">Appendix</h3>

<p>All of the source code used in this blog post is available on GitHub:</p>

<ul>
  <li><a href="https://github.com/myitcv/myfirstgoaction">github.com/myitcv/myfirstgoaction</a></li>
  <li><a href="https://github.com/myitcv/usingmyfirstgoaction">github.com/myitcv/usingmyfirstgoaction</a></li>
</ul>

<p>With thanks to <a href="https://twitter.com/mvdan_">Daniel Mart√≠</a> for reviewing this post.</p>

  </div><div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://blog.myitcv.io/2020/02/04/portable-ci-cd-with-pure-go-github-actions.html';
      this.page.identifier = 'https://blog.myitcv.io/2020/02/04/portable-ci-cd-with-pure-go-github-actions.html';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://myitcv.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><a class="u-url" href="/2020/02/04/portable-ci-cd-with-pure-go-github-actions.html" hidden></a>
</article>

      </div>
    </main>

    
<footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">blog.myitcv.io</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              Paul Jolly
            
            </li>
          <li>
            <a href="https://myitcv.io">https://myitcv.io</a>
          </li>
            
            <li><a href="mailto:paul@myitcv.io">paul@myitcv.io</a></li>
            
        </ul>

        <p class="rss-subscribe"><a href="/feed.xml"><img style="width: 20px; height: 20px" src="/assets/rss.svg"/>&nbsp;RSS</a></p>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/myitcv"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">myitcv</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/_myitcv"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">_myitcv</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>A largely Go-based blog
</p>

      </div>
    </div>

  </div>

</footer>

    <script>
  var anchorForHeader = function(heading) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = "#" + heading.id;
    anchor.innerHTML = "<svg class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>";
    anchor.title = "Permalink";
    anchor.style = "float: left; margin-left: -20px; padding-right: 4px;";
    return anchor;
  };
  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    var work = [];
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];
      if (typeof header.id !== "undefined" && header.id !== "") {
        header.insertBefore(anchorForHeader(header), header.firstChild);
      }
    }
  };
  document.onreadystatechange = function () {
    if (this.readyState === "complete") {
      var contentBlock = document.getElementsByClassName("post-content")[0] || document.getElementsByClassName("news")[0];
      if (!contentBlock) {
        return;
      }
      for (var level = 1; level <= 6; level++) {
        linkifyAnchors(level, contentBlock);
      }
    }
  };
</script>


  </body>

</html>
